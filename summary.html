<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resumen</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header>
        <h1>Resumen</h1>
    </header>
    <main>
        <div class="summary-container">
            <h2>Tus Componentes Seleccionados</h2>
            <ul class="summary-list">
                <li><strong>CPU:</strong> <span id="cpu"></span></li>
                <li><strong>GPU:</strong> <span id="gpu"></span></li>
                <li><strong>RAM:</strong> <span id="ram"></span></li>
                <li><strong>Almacenamiento:</strong> <span id="storage"></span></li>
                <li><strong>Caja:</strong> <span id="case"></span></li>
            </ul>
            <p class="total-price"><strong>Precio Total:</strong> €<span id="totalPrice"></span></p>
            <button class="buy-button">Comprar Ahora</button>
        </div>
    </main>
    <div class="optional-components">
        <h3>Componentes Opcionales</h3>
        <form id="optionalForm">
            <label>
                <input type="checkbox" name="optional" value="keyboard" data-price="30">
                Teclado (€30)
            </label><br>
            <label>
                <input type="checkbox" name="optional" value="mouse" data-price="20">
                Ratón (€20)
            </label><br>
            <label>
                <input type="checkbox" name="optional" value="monitor" data-price="150">
                Pantalla (€150)
            </label><br>
            <button type="button" id="updatePriceButton">Actualizar Precio</button>
        </form>
    </div>
    <script type="module">
        import { prices } from './js/prices.js';

        const components = [
            { id: 'cpu', name: 'CPU', required: true },
            { id: 'gpu', name: 'GPU', required: true },
            { id: 'ram', name: 'RAM', required: true },
            { id: 'storage', name: 'Almacenamiento', required: true },
            { id: 'case', name: 'Caja', required: true },
            { id: 'keyboard', name: 'Teclado', required: false, price: 30 },
            { id: 'mouse', name: 'Ratón', required: false, price: 20 },
            { id: 'monitor', name: 'Pantalla', required: false, price: 150 }
        ];

        const params = new URLSearchParams(window.location.search);
        const summaryList = document.querySelector('.summary-list');
        const totalPriceElement = document.getElementById('totalPrice');

        let totalPrice = 0;

        // Clear the summary list to avoid duplicates
        summaryList.innerHTML = '';

        components.forEach(component => {
            const value = component.required ? params.get(component.id) : component.id;
            const price = component.required ? prices[value] || 0 : component.price;

            if (component.required || document.querySelector(`input[name="optional"][value="${component.id}"]`)?.checked) {
                const listItem = document.createElement('li');
                listItem.innerHTML = `<strong>${component.name}:</strong> ${value} - €${price}`;
                summaryList.appendChild(listItem);
            }

            if (component.required) {
                totalPrice += price;
            }
        });

        totalPriceElement.textContent = totalPrice;

        document.getElementById('updatePriceButton').addEventListener('click', () => {
            let updatedPrice = totalPrice; // Start with the base price of required components

            // Clear the summary list to recalculate
            summaryList.innerHTML = '';

            components.forEach(component => {
                const value = component.required ? params.get(component.id) : component.id;
                const price = component.required ? prices[value] || 0 : component.price;

                if (component.required || document.querySelector(`input[name="optional"][value="${component.id}"]`)?.checked) {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `<strong>${component.name}:</strong> ${value} - €${price}`;
                    summaryList.appendChild(listItem);
                    updatedPrice += component.required ? 0 : price; // Add price only for optional components
                }
            });

            totalPriceElement.textContent = updatedPrice;
        });
    </script>
</body>
</html>